---
title: "Claims reserving of a French Motor Third Party Liability triangle dataset"
date: '`r Sys.Date()`'
date-format: "MMMM, YYYY"
author: "Julien Siharath"
chapters:
  - Introduction
  - Models
  - Graphs
categories: [Triangle, Reserving, Claim amount, France, fretri1auto9605]
bibliography: references.bib
editor:
  markdown:
    wrap: 72
format:
  html:     
    code-fold: true
    code-summary: "Show the code"
    css: style.scss
    theme: cosmo
    toc: true
    toc-depth: 2
vignette: >
  %\VignetteIndexEntry{Claims reserving of a French Motor Third Party Liability triangle dataset}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}       
---

# Introduction {#sec-triangles-introduction}

```{r setup, message=FALSE, warning=FALSE}
#| code-fold: true
#| code-summary: "Session Settings"
#| label: load-packages

# Graphs----
face_text='plain'
face_title='plain'
size_title = 14
size_text = 11
legend_size = 11
```

```{css setup, echo = FALSE}
.justify {
  text-align: justify !important
}
```

::: callout-tip
### In Brief

The purpose of this vignette is to illustrate a reserving exercise aimed at forecasting future claims development, specifically focusing on the bottom right corner of the triangle and potential further developments. These estimates are essential for maintaining the financial stability of insurance companies and ensuring they can meet their future claim obligations. We will use the `fretri1auto9605` dataset from @charpentierCAS and work with the `Chainladder` package. 
:::

## Required Packages

```{r libraries, message=FALSE}

required_libraries <- c(
  "tidyverse", 
  "CASdatasets",
  "ChainLadder"
)
invisible(lapply(required_libraries, library, character.only = TRUE))
```

## Data

::: justify

The dataset `fretri1auto9605` comprises claim triangles for motor policies from a French non-life insurer spanning the years 1996 to 2005.

In this context, a triangle is a table used to display data over time. It shows information across two dimensions: 

- Lines as origin Year: This is the year when the claim occurred.\

- Columns as development Year: This indicates the number of years that have passed since the origin year.\

The table helps to track and analyze how data evolves from the time of origin over subsequent years.

`fretri1auto9605` includes the following elements:

- Damage guarantee\
- Body guarantee\
- Total\

Each element includes two types of triangles: paid claims and incurred claim amounts.

Hereâ€™s how they differ:

Paid Claims: These triangles display cumulative claim amounts. This means that for each development year, the amount shown includes all claims paid up to that point. As time progresses, the cumulative total increases or remains the same, never decreasing, as it reflects the ongoing addition of payments.

Incurred Claim Amounts: These triangles reflect the total estimated amount for claims that have occurred but are not necessarily paid yet. Unlike paid claims, the incurred amount is not cumulative. It represents the estimated total cost of claims for a specific development year, which can be adjusted based on new information or revisions. As such, the incurred amount can change over time, and it might not show a simple increasing trend.

We will focus on the triangle representing the paid damage claim amounts, which we will refer to as `Damage`.
:::

## Dictionaries

The list of the 3 elements from the `fretri1auto9605` dataset is reported
in @tbl-dict-fretri1auto9605.

::: justify
| Elements | Description                                             |
|----------|---------------------------------------------------------|
| damage   | Represents the damage guarantee for the insurance policy.|
| body     | Represents the body guarantee for the insurance policy.|
| total    | Represents the total guarantee.|


: Content of the `fretri1auto9605` {#tbl-dict-fretri1auto9605
.striped .hover}

The list of the 2 triangles in each elements is reported
in @tbl-dict-triangle.


| Triangle  |  Description                                            |
|-----------|---------------------------------------------------------|
| paid      | Shows the cumulative amount of claims paid up to each development period.|
| incur     | Represents the estimated total amount for claims that have occurred but are not necessarily paid yet.|

: Content in each triangle {#tbl-dict-triangle
.striped .hover}
:::


## Importation

```{r load-triangles-data, output=FALSE}
#| code-fold: true
#| code-summary: "Code for importing our dataset"

data(fretri1auto9605)

Damage <- fretri1auto9605$damage$paid|>
  as.triangle()
```

# Overview {#sec-triangles-overview}

## Purpose

::: justify
Unlike other industries, the insurance sector does not sell tangible products but rather promises. An insurance policy represents a commitment by the insurer to cover future claims in exchange for a premium paid upfront.

Consequently, insurers do not know the exact cost of their services in advance. Instead, they rely on historical data analysis and judgment to set a sustainable price for their offerings. In General Insurance (or Non-Life Insurance, such as motor, property, and casualty insurance), most policies are valid for a period of 12 months. However, the claims payment process can extend over several years or even decades. As a result, insurers often do not know the exact timing of when claims will be settled.

For example, after a major natural disaster like an earthquake, the sheer volume of claims can overwhelm an insurance company. Evaluating the damage to properties, businesses, and personal belongings can be a time-consuming process. Additionally, some claims may require detailed investigations to determine the extent of coverage and validate the legitimacy of the claims. In such cases, the settlements delay can be significant as insurers need time to thoroughly assess each claim and ensure accurate payouts.

To forecast future claims and manage pricing effectively, insurers use methods like chain ladder models. These models estimate future claims based on historical data and are crucial for anticipating upcoming challenges. We will showcase the ability of chain ladder models to provide  forecasts, refine pricing strategies, and ensure resilience in a dynamic risk landscape. For additional details and insights on claims reserving, refer to @gesmann2014claims.

:::

::: panel-tabset
## Data overview

```{r data-print}
#| code-fold: true

print(Damage)
```

## Claims development chart

```{r TRIANGLES-plot}
#| fig-cap: "Claims development chart of the damage triangle, with one line per origin period."
#| label: "fig-dev-chart"
#| code-fold: true
#| code-summary: Code to create the following graph
#| fig-width: 9
#| fig-height: 5

ChainLadder::plot(Damage/1000)
```
## Origin year plot

```{r plot-origin-year}
#| fig-cap: "Claims development by origin year"
#| label: "fig-dev-origin"
#| code-fold: true
#| code-summary: Code to create the following graph
#| fig-width: 8
#| fig-height: 5

plot(Damage/1000, lattice=TRUE)
```
:::

# Mack chain-ladder

::: justify
Thomas Mack published in @Mack_distributionfree1993 a
method which estimates the standard errors of the
chain-ladder forecast without assuming a distribution under three
conditions.

Following the notation of @Mack1999 let $C_{ik}$ denote the cumulative loss
amounts of origin period (e.g., accident year) $i=1,\ldots,m$, with
losses known for development period  (e.g., development year) $k \le n+1-i.$

In order to forecast the amounts $C_{ik}$ for $k > n+1-i$ the Mack
chain-ladder-model assumes:

$$
\begin{aligned}
  \mbox{CL1: }  & E[ F_{ik}| C_{i1},C_{i2},\ldots,C_{ik} ] = f_k
  \mbox{ with } F_{ik}=\frac{C_{i,k+1}}{C_{ik}}\\
    \mbox{CL2: } &  Var( \frac{C_{i,k+1}}{C_{ik}} | C_{i1},C_{i2},
    \ldots,C_{ik} ) = \frac{\sigma_k^2}{w_{ik} C^\alpha_{ik}}\\
  \mbox{CL3: } & \{C_{i1},\ldots,C_{in}\}, \{
    C_{j1},\ldots,C_{jn}\},\mbox{ are independent for origin period } i
    \neq j
\end{aligned}
$$

with $w_{ik} \in [0;1], \alpha \in \{0,1,2\}$.  If these
assumptions hold, the Mack chain-ladder-model gives an
unbiased estimator for IBNR (Incurred But Not Reported) claims.

## Intuition Behind the Method

The Chain-Ladder model is used to project future claims based on historical data. The fundamental idea is that the pattern of claims development is relatively stable and predictable. The model assumes that the ratios of cumulative losses between successive development years remain consistent, allowing us to use these ratios to estimate future losses.

**Assumptions:**

1. **CL1: Expected Future Ratio**  
   This assumption states that the expected future ratio  $F_{ik}$ of cumulative losses between successive development years is constant, given the known losses up to the current development year. In other words, the ratio of cumulative losses from one development year to the next is assumed to follow a consistent pattern, which can be summarized by a factor $f_k$ that reflects this pattern.

2. **CL2: Variance of Future Ratio**  
   This assumption specifies how the variance of the future ratio of cumulative losses behaves. It indicates that the variance is proportional to $\frac{\sigma_k^2}{w_{ik} C_{ik}^\alpha}$, where $\sigma_k^2$ captures the variability, $w_{ik}$ is a weight, and $\alpha$ is a parameter that adjusts for different levels of variance. This helps in quantifying the uncertainty around the forecasts.

3. **CL3: Independence of Origin Periods**  
   This assumption ensures that the cumulative loss amounts from different origin periods are independent of each other. This means that the losses from one accident year do not affect the losses from another year, allowing for simpler and more robust estimation.

The Mack Chain-Ladder model can be regarded as a weighted linear regression through the origin for each development period:

The Mack chain-ladder model can be regarded as a weighted linear regression
through the origin for each development period:
`lm(y ~ x  + 0, weights=w/x^(2-alpha))`,
where $y$ is the vector of claims at development period
$k+1$ and $x$ is  the vector of claims at development period
$k$.

The Mack method is implemented in the ChainLadder package via the
function `MackChainLadder`.

As an example we apply the `MackChainLadder` function to our
triangle `Damage`:
::: 

```{r MackChainLadder}
#| code-fold: false

mack <- MackChainLadder(Damage, est.sigma="Mack")
mack # same as summary(mack) 
```
```{r fulltriangle}
#| code-fold: false
#| code-summary: Show the code

# Displaying the Mack model's parameters
mack$f

# Viewing the full triangle data from the Mack model
mack$FullTriangle
```
::: justify

The Mack model factors begin at 1.3 for the initial periods and gradually decrease to around 1 for the later periods. These factors represent the development factors for each period, indicating the expected growth in cumulative claims from one period to the next. This trend mirrors the typical pattern in insurance claims, where most claims are reported early in the development process, and the rate of increase slows down over time as claims stabilize.

The triangular data shows how claims develop over time for each origin period. For example, for the origin year 2005, claims start at 92422 in the 1st period and grow to 121413 by the 10th period. This pattern is essential for actuaries to predict future claims and set appropriate reserves.

Overall, this output provides a comprehensive view of how claims develop over time and the associated development factors used in the chain ladder method.

:::


# Graphs {#sec-mack-graph}
::: panel-tabset

## Model's Plot {#sec-summary-mack}

::: {.callout-caution appearance="simple"}
### Pay Attention

::: justify
To check that Mack's assumption are valid, review the residual plots,
we should see no trends in either of them.
:::
:::
```{r Visualisation-mack, message = FALSE}
#| fig-cap: MackPlot
#| label: "fig-plot-Mack1"
#| code-fold: true
#| code-summary: Code to create the following graph
#| fig-width: 8
#| fig-height: 8

plot(mack)
```
There are no apparent trend so the model is valid.

## Lattice plot {#sec-summary-mack-lattice}
We can plot the development, including the forecast and estimated
standard errors by origin period by setting the argument `lattice=TRUE`.


```{r visualisation-mack-lattice}
#| fig-cap: MackPlot Lattice
#| label: "fig-plot-Mack2"
#| code-fold: true
#| code-summary: Code to create the following graph
#| fig-width: 8
#| fig-height: 5

plot(mack, lattice=TRUE)
```
:::

# References

::: {#refs}
:::

# See also

::: justify
For more similar triangles datasets, see
[`nortritpl8800`](https://dutangc.github.io/CASdatasets/reference/nortritpl.html)
(import with `data("ausprivauto0405")`): Australian liabilty insurance triangles dataset,
[`sgautoprop9701`](https://dutangc.github.io/CASdatasets/reference/sgtriangles.html):
Singapore general liability triangles dataset (import with `data("norauto")`),
[`swtri1auto`](https://dutangc.github.io/CASdatasets/reference/swtriangles.html):
Switzerland general liability triangles dataset (import with `data("beMTPL16")`), or
[`usautotri9504`](https://dutangc.github.io/CASdatasets/reference/usautotri.html)
(import with `data("pg17trainpol")`): US Automobile triangles dataset.
:::
